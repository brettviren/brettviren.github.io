<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-02-09 Tue 13:57 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>How I Do</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Brett Viren" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="export/styles/darksun/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="export/styles/darksun/css/darksun.css"/>
<link rel="stylesheet" type="text/css" href="export/styles/darksun/css/hideshow.css"/>
<script type="text/javascript" src="export/styles/darksun/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="export/styles/darksun/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="export/styles/darksun/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="export/styles/darksun/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="export/styles/darksun/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="export/styles/darksun/js/darksun.js"></script>
<script type="text/javascript" src="export/styles/darksun/js/hideshow.js"></script>
<script type="text/javascript" src="export/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">How I Do
<br />
<span class="subtitle">Documenting my digital environment</span>
</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#2021-02-09-Introduction">Introduction</a>
<ul>
<li><a href="#2021-02-09-Typography">Typography</a></li>
<li><a href="#2021-02-09-Hardware">Hardware</a></li>
</ul>
</li>
<li><a href="#2021-02-09-Configuration">Configuration</a>
<ul>
<li><a href="#2021-02-09-Configuration-Initialize">Initialize</a></li>
<li><a href="#2021-02-09-Multiple-repositories">Multiple repositories</a></li>
<li><a href="#2021-02-09-Bootstrap-new-account">Bootstrap new account</a></li>
<li><a href="#2021-02-09-Ignoring">Ignoring</a></li>
<li><a href="#2021-02-09-Making-updates">Making updates</a></li>
<li><a href="#2021-02-09-Applying-updates">Applying updates</a></li>
<li><a href="#2021-02-09-Checking-for-updates">Checking for updates</a></li>
</ul>
</li>
<li><a href="#2021-02-09-Editor">Editor</a>
<ul>
<li><a href="#2021-02-09-Emacs">Emacs</a>
<ul>
<li><a href="#org91decd6">Emacs packages</a></li>
<li><a href="#orgd0f3775">Modular config</a></li>
<li><a href="#orgb251c92">GNUS/BBDB</a></li>
<li><a href="#orgb83a140">LSP</a></li>
<li><a href="#org4bf9b51">Emacs servers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#2021-02-09-Terminal">Terminal</a>
<ul>
<li><a href="#2021-02-09-Kitty">Kitty</a></li>
</ul>
</li>
<li><a href="#2021-02-09-Command-shell">Shells</a>
<ul>
<li><a href="#2021-02-09-Fish">Fish</a></li>
<li><a href="#2021-02-09-Bash">Bash</a></li>
</ul>
</li>
<li><a href="#2021-02-09-Desktop">Desktop</a>
<ul>
<li><a href="#2021-02-09-Herbsluftwm">Herbsluftwm</a></li>
<li><a href="#orgd8a56da">Rofi</a></li>
<li><a href="#2021-02-09-Sawfish">Sawfish</a></li>
<li><a href="#org4c2eab7">Desktop environment</a></li>
</ul>
</li>
<li><a href="#2021-02-09-Web">Web</a>
<ul>
<li><a href="#2021-02-09-Firefox">Firefox</a>
<ul>
<li><a href="#orgfa29ca2">Load URL via remote without grabbing attention</a></li>
<li><a href="#org1c0b1ab">Emacs-like keybindings in firefox</a></li>
<li><a href="#org28de096">Using Emacs to edit text</a>
<ul>
<li><a href="#org66574e4"><span class="todo TODO">TODO</span> get nice rendered preview for GitHub and Reddit text entries</a></li>
</ul>
</li>
<li><a href="#orgfdfa56e">Bookmark capture</a></li>
<li><a href="#org4855e62">Kill Sticky</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#2021-02-09-Source">Source</a>
<ul>
<li><a href="#2021-02-09-DIY-opt">DIY opt</a></li>
<li><a href="#2021-02-09-Stow">Stow</a></li>
<li><a href="#2021-02-09-CMake">CMake</a></li>
<li><a href="#2021-02-09-autoconf">autoconf</a></li>
<li><a href="#2021-02-09-Spack">Spack</a></li>
<li><a href="#2021-02-09-Nix">Nix</a></li>
<li><a href="#2021-02-09-Python">Python</a></li>
</ul>
</li>
<li><a href="#2021-02-09-Photo-management">Photos</a>
<ul>
<li><a href="#2021-02-09-Rephile">Rephile</a></li>
</ul>
</li>
<li><a href="#2021-02-09-Sync">Sync</a>
<ul>
<li><a href="#2021-02-09-Syncthing">Syncthing</a></li>
<li><a href="#2021-02-09-Git-annex">Git annex</a></li>
</ul>
</li>
<li><a href="#orge6d2070">Passwords</a>
<ul>
<li><a href="#org3434fa7">Pass</a></li>
</ul>
</li>
<li><a href="#2021-02-09-Time">Time</a>
<ul>
<li><a href="#2021-02-09-arbtt">arbtt</a></li>
<li><a href="#2021-02-09-Meetings">Time zones</a></li>
<li><a href="#org5db678c">Meetings</a></li>
</ul>
</li>
<li><a href="#org7ecaf7d">Todo</a></li>
</ul>
</div>
</div>
<p>
Sometimes people ask how I (digitally) do things.  They can read this.
</p>

<div id="outline-container-orgd73752d" class="outline-2">
<h2 id="2021-02-09-Introduction">Introduction</h2>
<div class="outline-text-2" id="text-2021-02-09-Introduction">
<p>
This document provides a view into how I use computers with a focus on software.  It is organized into major software categories with subsections for each important package.
</p>

<p>
It also serves as notebook of documentation to remind me of some details.  Expect some incomplete sections and to see changes over time.
</p>
</div>

<div id="outline-container-org8964236" class="outline-3">
<h3 id="2021-02-09-Typography">Typography</h3>
<div class="outline-text-3" id="text-2021-02-09-Typography">
<p>
In this document, the prompts used in examples are as:
</p>

<pre class="example">
# command run as root
$ command run as user
</pre>
</div>
</div>

<div id="outline-container-org94cdb29" class="outline-3">
<h3 id="2021-02-09-Hardware">Hardware</h3>
<div class="outline-text-3" id="text-2021-02-09-Hardware">
<p>
Hardware interests me less than software so I do not go into detail other than to give hostnames to four hardware roles:
</p>

<dl class="org-dl">
<dt><code>hometop</code></dt><dd>personal laptop (thinkpad x1e gen2)</dd>
<dt><code>worktop</code></dt><dd>work laptop (thinkpad x1c gen5)</dd>
<dt><code>homestation</code></dt><dd>personal workstation (custom build)</dd>
<dt><code>workstation</code></dt><dd>work workstation (ASLab Marquis)</dd>
<dt><code>homeserver</code></dt><dd>personal server with ports exposed to the Internet</dd>
</dl>

<p>
For the last one, I maintain a dynamic DNS subdomain from the great folks at <a href="https://freedns.afraid.org/">afraid</a>.
</p>
</div>
</div>
</div>


<div id="outline-container-org7465c12" class="outline-2">
<h2 id="2021-02-09-Configuration">Configuration</h2>
<div class="outline-text-2" id="text-2021-02-09-Configuration">
<p>
Configuration is stored in a private <a href="https://gitea.io/">Gitea</a> and most clones are managed with <a href="https://github.com/RichiH/vcsh">vcsh</a> and <a href="https://myrepos.branchable.com/">myrepos</a> with <a href="https://www.passwordstore.org/">pass</a> managing its own.
</p>

<p>
The vcsh git repo manager allows multiple git repos to supply files into <code>$HOME</code> without any actual <code>.git/</code> directory there.  It allows for the target filesystem space to be interleaved with files managed in separate git repos.  Seems crazy, works great.
</p>

<p>
My <code>vcsh</code> repos include config for: bash, bbdb, emacs, git, mr (myrepos), nixpkgs, sawfish, scripts, ssh, systemd, tmux, weechat.  Some of these are described in other sections but first how <code>vcsh</code> is handled.
</p>
</div>

<div id="outline-container-org4fba925" class="outline-3">
<h3 id="2021-02-09-Configuration-Initialize">Initialize</h3>
<div class="outline-text-3" id="text-2021-02-09-Configuration-Initialize">
<p>
Each repo needs a one time setup like:
</p>

<pre class="example">
# apt install vcsh
$ vcsh init bbdb
$ vcsh bbdb add .bbdb
$ vcsh bbdb commit -m "First commit"
$ vcsh bbdb remote add origin gogs@homeserver:bv/dot-bbdb.git
$ vcsh bbdb push -u origin master
</pre>
</div>
</div>

<div id="outline-container-orgf2644bb" class="outline-3">
<h3 id="2021-02-09-Multiple-repositories">Multiple repositories</h3>
<div class="outline-text-3" id="text-2021-02-09-Multiple-repositories">
<p>
There is built-in support for multiple repositories in <code>vcsh</code>, eg:
</p>

<pre class="example">
$ vcsh status
$ vcsh pull
$ vcsh push
</pre>
</div>
</div>

<div id="outline-container-org2eb6814" class="outline-3">
<h3 id="2021-02-09-Bootstrap-new-account">Bootstrap new account</h3>
<div class="outline-text-3" id="text-2021-02-09-Bootstrap-new-account">
<p>
A new account can clone individual repos:
</p>

<pre class="example">
$ vcsh clone gogs@homeserver:bv/dot-bbdb.git bbdb
</pre>

<p>
This gets tedious and it's where <code>myrepos</code> (<code>mr</code>) comes in.
</p>

<pre class="example">
$ vcsh clone gogs@haiku:bv/dot-myrepos.git mr
$ cd .config/mr/config.d/
$ ln -sf ../available.d/* . 
$ cd 
$ mr up
</pre>

<p>
An example <code>mr</code> config looks like:
</p>

<pre class="example">
[$HOME/.config/vcsh/repo.d/emacs.git]
checkout = vcsh clone gogs@bandyv.us.to:bv/dot-emacs.git emacs
</pre>
</div>
</div>

<div id="outline-container-org28ab2a1" class="outline-3">
<h3 id="2021-02-09-Ignoring">Ignoring</h3>
<div class="outline-text-3" id="text-2021-02-09-Ignoring">
<p>
Any git command run through <code>vcsh</code> uses <code>$HOME</code> as the Git working dir.
</p>

<pre class="example">
$ vcsh bbdb status
[... long list of untracked files ...]
</pre>

<p>
You can have <code>vcsh</code> Git command ignore anything not explicitly committed to a <code>vcsh</code> Git repository:
</p>

<pre class="example">
$ vcsh write-gitignore bbdb
$ vcsh bbdb status
On branch master
Your branch is up-to-date with 'origin/master'.
nothing to commit, working directory clean
</pre>

<p>
The <code>write-gitignore</code> command will create a file like:
</p>

<pre class="example">
$ cat ~/.gitignore.d/bbdb 
*
!/.bbdb
</pre>
</div>
</div>

<div id="outline-container-org148b01e" class="outline-3">
<h3 id="2021-02-09-Making-updates">Making updates</h3>
<div class="outline-text-3" id="text-2021-02-09-Making-updates">
<pre class="example">
$ emacs .bash/completion/vcsh
$ vcsh bash add -f .bash/completion/vcsh
$ vcsh bash commit -a -m "Add vcsh completion for bash."
$ vcsh bash push
</pre>
</div>
</div>

<div id="outline-container-org7072a1b" class="outline-3">
<h3 id="2021-02-09-Applying-updates">Applying updates</h3>
<div class="outline-text-3" id="text-2021-02-09-Applying-updates">
<p>
From each account:
</p>

<pre class="example">
$ mr up
</pre>

<p>
or, more usually
</p>

<pre class="example">
$ vcsh pull
</pre>
</div>
</div>


<div id="outline-container-org0c2f2de" class="outline-3">
<h3 id="2021-02-09-Checking-for-updates">Checking for updates</h3>
<div class="outline-text-3" id="text-2021-02-09-Checking-for-updates">
<p>
I want my prompt to tell me when a local account has modified, is
behind the remote vcsh or ahead of it (made a commit but not push).
To check the remote takes time and also needs SSH credentials.  Here's
how I get this bundle of functionality:
</p>

<dl class="org-dl">
<dt><code>vcsh-extra</code></dt><dd>a script with command <code>hooks</code>, <code>probe</code> and <code>cron</code> which
calls both.</dd>

<dt>fetch</dt><dd>the <code>fetch</code> command simply does a:</dd>
</dl>

<div class="org-src-container">
<pre class="src src-shell">vcsh foreach fetch
</pre>
</div>

<dl class="org-dl">
<dt>probe</dt><dd>the <code>probe</code> command will run <code>vcsh status --terse</code> and parse it
for state to touch files <code>last-{ahead,behind,modified}</code> (removing any
stale ones).</dd>

<dt>hooks</dt><dd>the <code>hooks</code> command install vcsh hooks which will run the
<code>probe</code> command named after an action.  Ie in:
<code>post-{pull,push,commit,enter,run}</code> is:</dd>
</dl>

<div class="org-src-container">
<pre class="src src-shell">$<span style="color: #fcaf3e;">HOME</span>/scripts/vcsh-extra probe
</pre>
</div>

<dl class="org-dl">
<dt>cron</dt><dd>the <code>cron</code> command bundles calls the three commands in sequence after</dd>
</dl>

<pre class="example">
eval $(keychain --quiet --noask --eval id_rsa)
</pre>

<p>
In summary, the cron job runs once per hour, fetching but not applying
any changes and doing the <code>probe</code> to summarize what state that leaves
the local <code>vcsh</code> repositories.
</p>

<p>
When doing <code>vcsh</code> commands the hooks run to repeat the <code>probe</code> (which is
fast enough).
</p>

<p>
Finally, the Bash <code>PROMPT_COMMAND</code> will check for the existence
<code>last-{ahead,behind,modified}</code> files and prepend a little marker to the
prompt.  If all three types of "dirty" occur, the prompt looks like:
</p>

<pre class="example">
{ABM}bv@hal:~
$ 
</pre>
</div>
</div>
</div>




<div id="outline-container-org155d4ab" class="outline-2">
<h2 id="2021-02-09-Editor">Editor</h2>
<div class="outline-text-2" id="text-2021-02-09-Editor">
</div>

<div id="outline-container-orgbeeb1d1" class="outline-3">
<h3 id="2021-02-09-Emacs">Emacs</h3>
<div class="outline-text-3" id="text-2021-02-09-Emacs">
<p>
I use Emacs for Email (GNUS), Contacts (BBDB), software development,
document and presentation production (orgmode and LaTeX), bookmark
management (<code>org-protocol</code> and <code>org-capture</code>) and web form text entry
(<code>atomic-chrome</code>).  Emacs 27 is soon to be released but I can't wait
so I build it from source (see <a href="#2021-02-09-Source">Source</a>).  It now allows
<code>XDG_CONFIG_HOME</code> which I make use of by <b>conceptually</b> doing:
</p>

<pre class="example">
$ rm -rf .emacs*
$ mkdir .config/emacs
</pre>

<p>
Typing <code>emacs</code> then uses <code>$XDG_CONFIG_HOME/emacs/init.el</code>.  There's
lots of fashionable ways to configure <code>init.el</code>.  I don't follow then
except to break up the config into many <code>init-*.el</code> and <code>(require)</code>
them in a big list.  
</p>
</div>

<div id="outline-container-org91decd6" class="outline-4">
<h4 id="org91decd6">Emacs packages</h4>
<div class="outline-text-4" id="text-org91decd6">
<p>
I heavily use <a href="https://github.com/jwiegley/use-package">use-package</a> and in two modes.  I
want the ability to blow away any <code>emacs.d/elpa/</code> area and rebuild it
any time but normally don't want to spend the extra load time to query
for package state.  This is in <code>init-package.el</code>:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #b4fa70;">require</span> '<span style="color: #e9b2e3;">package</span>)
(<span style="color: #b4fa70;">setq</span> package-archives
      '((<span style="color: #e9b96e;">"org"</span>     .       <span style="color: #e9b96e;">"https://orgmode.org/elpa/"</span>)
        (<span style="color: #e9b96e;">"gnu"</span>     .       <span style="color: #e9b96e;">"https://elpa.gnu.org/packages/"</span>)
        (<span style="color: #e9b96e;">"melpa"</span>   .       <span style="color: #e9b96e;">"https://melpa.org/packages/"</span>)))
(package-initialize)
<span style="color: #73d216;">;; </span><span style="color: #73d216;">uncomment this block and restart emacs to get new packages</span>
<span style="color: #73d216;">;;;;;</span>
<span style="color: #73d216;">;; </span><span style="color: #73d216;">(setq use-package-always-ensure t)</span>
<span style="color: #73d216;">;; </span><span style="color: #73d216;">(package-refresh-contents)</span>
<span style="color: #73d216;">;; </span><span style="color: #73d216;">(unless (package-installed-p 'use-package)</span>
<span style="color: #73d216;">;;   </span><span style="color: #73d216;">(package-install 'use-package))</span>
<span style="color: #73d216;">;;;;;;</span>
(<span style="color: #b4fa70;">require</span> '<span style="color: #e9b2e3;">use-package</span>)
(<span style="color: #b4fa70;">provide</span> '<span style="color: #e9b2e3;">init-packages</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd0f3775" class="outline-4">
<h4 id="orgd0f3775">Modular config</h4>
<div class="outline-text-4" id="text-orgd0f3775">
<p>
I factor my Emacs configuration as par <code>modular-config</code> with "modules" in <code>~/.config/emacs/init/*.el</code> and some top level configs listed like:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #b4fa70;">use-package</span> <span style="color: #e9b2e3;">modular-config</span>
  <span style="color: #e090d7;">:custom</span>
  (modular-config-list
   '(
     (full (base gui orgmode dired smex spelling markdown lisp cpp python jsonnet tail))
     (email (base gui orgmode email))
     (empty ())
     (plain (base))
     (main (base gui orgmode))
     <span style="color: #73d216;">;; </span><span style="color: #73d216;">Used from EDITOR</span>
     (cmdline (base cli))
     <span style="color: #73d216;">;; </span><span style="color: #73d216;">Used from $VISUAL</span>
     (visual (base gui))
     (blog (base gui orgpub dired smex spelling markdown cpp python))
     (prog (base gui orgmode dired smex spelling markdown cpp python))
     <span style="color: #73d216;">;; </span><span style="color: #73d216;">for calling from GhostText, except we still do it</span>
     <span style="color: #73d216;">;; </span><span style="color: #73d216;">through init-atomic-chrome.el</span>
     (ghost (base gui dired ivy smex spelling markdown))
     <span style="color: #73d216;">;; </span><span style="color: #73d216;">for calling from $EDITOR</span>
     (shell (base gui dired ivy smex spelling))
     ))
  (modular-config-default 'full)
  (modular-config-path <span style="color: #e9b96e;">"~/.config/emacs/init"</span>)
  <span style="color: #e090d7;">:config</span>
  (modular-config-command-line-args-process))
</pre>
</div>

<p>
I then may select a configuration on the command line like:
</p>

<pre class="example">
$ emacs --config plain [...]
</pre>
</div>
</div>


<div id="outline-container-orgb251c92" class="outline-4">
<h4 id="orgb251c92">GNUS/BBDB</h4>
</div>

<div id="outline-container-orgb83a140" class="outline-4">
<h4 id="orgb83a140">LSP</h4>
</div>

<div id="outline-container-org4bf9b51" class="outline-4">
<h4 id="org4bf9b51">Emacs servers</h4>
<div class="outline-text-4" id="text-org4bf9b51">
<p>
To support bookmark capture (Firefox + org-protocol + a script) and text entry editing (GhostText + atomic-chrome) I have dedicated Emacs server configuration as well.  These servers are started via <code>supervisord</code> which itself starts from cron:
</p>

<pre class="example">
$ crontab -l|grep supervisord
@reboot supervisord -c /home/bv/scripts/supervisor.conf
</pre>

<p>
That =~/scripts/~ directory is in <code>vcsh</code>.  The two Emacs servers are
started like:
</p>

<pre class="example">
[program:emacs-capture]
command=%(ENV_HOME)s/scripts/emacs-start-server capture
directory=%(ENV_HOME)s
autorestart = false

[program:emacs-atomic-chrome]
command=%(ENV_HOME)s/scripts/emacs-start-server atomic-chrome
directory=%(ENV_HOME)s
autorestart = false
</pre>

<p>
This <code>emacs-start-server</code> script is mostly to remind me how to start Emacs properly.  It boils down to running:
</p>

<pre class="example">
exec emacs -q --fg-daemon=${name} -l ~/.config/emacs/init-${name}.el
</pre>

<p>
As such the nominal <code>init.el</code> is not sourced.  Each server is self
contained including its <code>custom.el</code> and its <code>elpa/</code> area.
</p>

<p>
For bookmark capture I configure Firefox to call <code>~/scripts/emacs-capture</code> script for any <code>org-protocol://</code> links.  Effectively it calls:
</p>
<pre class="example">
emacsclient -n -c -s capture \
   -F "((name . \"emacs-capture\") (height . 20) (width . 80))" \
   "org-protocol://capture://w/&lt;encoded-url&gt;/"
</pre>

<p>
This runs on the "capture" server and since it uses <code>emacsclient</code> it starts very fast.
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-org384ec65" class="outline-2">
<h2 id="2021-02-09-Terminal">Terminal</h2>
<div class="outline-text-2" id="text-2021-02-09-Terminal">
</div>

<div id="outline-container-orgff1721d" class="outline-3">
<h3 id="2021-02-09-Kitty">Kitty</h3>
<div class="outline-text-3" id="text-2021-02-09-Kitty">
<p>
I've tried many terminals over the years and for about the last year I have been very happily using the <a href="https://sw.kovidgoyal.net/kitty/">Kitty</a> terminal.  I mean the one written in Python/OpenGL and not the on derived from Putty.  Some reasons why I like it:
</p>

<ul class="org-ul">
<li>emoji support!</li>
<li><code>C-S-h</code> to load scrollback into <code>less</code></li>
<li>fast, beautiful text, Free Software</li>
</ul>

<p>
It also has sub-programs called "kittens" such as <code>kitten icat
foo.png</code> to show a graphic in the terminal.  Or <code>kitten diff</code> to show
a pretty side-by-side diff.  These are nice but I rarely use them.
</p>

<p>
Here is install:
</p>

<pre class="example">
python3 setup.py --prefix=/usr/local/stow/kitty-0.19.3 linux-package                                               

</pre>

<p>
See <a href="https://sw.kovidgoyal.net/kitty/build.html">kitty build instructions</a> and <a href="#2021-02-09-Stow">Stow</a> for more info.
</p>


<p>
No longer but in the past, I built and ran Kitty directly from source:
</p>

<pre class="example">
$ cd dev/kitty
$ git pull
$ git checkout vX.Y.Z
$ make
</pre>

<p>
Then, run the result directly from the source:
</p>

<pre class="example">
$ cat bin/kitty 
#!/usr/bin/env python3
import runpy
runpy.run_path('/home/bv/dev/kitty', run_name='__main__')
</pre>

<p>
No particularly fancy config (lives in <code>.config/kitty/kitty.conf</code>).
</p>
</div>
</div>
</div>


<div id="outline-container-org31336f4" class="outline-2">
<h2 id="2021-02-09-Command-shell">Shells</h2>
<div class="outline-text-2" id="text-2021-02-09-Command-shell">
<p>
I have moved my main account on <code>hometop</code> and <code>homestation</code> to the Fish shell but have long and still use Bash on other accounts.  In Fish accounts I will sometimes still start Bash to do some complex command which I've yet to master in Fish.  In this mixed environment it is sometimes necessary to explicitly set <code>SHELL</code> to either <code>fish</code> or <code>bash</code>.
</p>
</div>

<div id="outline-container-org8745efa" class="outline-3">
<h3 id="2021-02-09-Fish">Fish</h3>
<div class="outline-text-3" id="text-2021-02-09-Fish">
<p>
Fish is a really amazing shell which requires very little configuration to make it "feel right".  Here are a few things I do with fish.
</p>

<p>
I use the <a href="https://github.com/IlanCosman/tide">tide</a> prompt which is very nice, easy and popular.  Amazingly, it is as I like it out of the box and I do very little customization.  
</p>

<p>
I use this <code>fzf</code> / Fish integration:
</p>

<pre class="example">
$ fisher add PatricF1/fzf.fish
</pre>

<p>
Only customization is to override the <code>C-f</code> keybinding as it's needed for my Emacs-trained fingers for character-forward.  In <code>config.fish</code>
</p>

<div class="org-src-container">
<pre class="src src-fish"><span style="color: #73d216;"># </span><span style="color: #73d216;">override fzf bindings</span>
<span style="color: #e090d7;">bind</span> --erase \cf
<span style="color: #e090d7;">bind</span> \co <span style="color: #e9b96e;">'__fzf_search_current_dir'</span>
</pre>
</div>

<p>
To use <code>direnv</code> I add per docs, <code>conf.d/direnv.fish</code> with
</p>

<div class="org-src-container">
<pre class="src src-fish"><span style="color: #b4fa70;">eval</span> (<span style="color: #e090d7;">direnv</span> hook <span style="color: #e090d7;">fish</span>)
</pre>
</div>

<p>
When I started learning Fish, I ported my shell implemenation <a href="https://github.com/brettviren/shist">shist</a> of <a href="https://github.com/barabo/advanced-shell-history">ash</a> to  <a href="https://github.com/brettviren/fishql">fishql</a>.  This gave a nice vehicle to dive into Fish programming.  However, I've stopped using it due to some quoting problem and because I find I almost never actually use the SQL query functionality.
</p>
</div>
</div>

<div id="outline-container-orgd29af0d" class="outline-3">
<h3 id="2021-02-09-Bash">Bash</h3>
<div class="outline-text-3" id="text-2021-02-09-Bash">
<p>
Though I am moving to Fish, I keep my Bash setup alive as I sometimes will start Bash in my Fish accounts and still have some accounts not yet moved to Fish. 
</p>

<p>
My <code>.bashrc</code> is run for login or subshells.  It delegates
configuration to scripts under
<code>/.bash/{functions,variables,apps}/*.sh</code> and "mounts" some git subtrees under <code>/.bash/subtrees</code>.  
</p>

<p>
One subtree of note is <a href="https://github.com/brettviren/shist">shist</a> which is my Bash implementation of <a href="https://github.com/barabo/advanced-shell-history">advanced shell history</a>.  This integrates with Bash prompting to record history in an Sqlite3 database.
</p>

<p>
I strongly avoid using <code>alias</code> (eg, no <code>ll</code> for <code>ls -l</code>) as I think inventing my own Unix command set is an anti-pattern.  I do capture some larger commands in Bash functions so that tab-completion can remind me of the (eg, a bunch of <code>emacs-server-*</code> functions to manage different Emacs servers).
</p>

<p>
I used to loop over <code>$HOME/opt/*/{bin,lib,man,lib/pkgconfig}</code> to set <code>PATH, LD_LIBRARY_PATH, MANPATH, PKG_CONFIG_PATH</code>.  This I now deprecate in favor of a Stow-based install for common software and a per-development area governed by <code>direnv</code>.
See <a href="#2021-02-09-Source">Source</a> for more info on this aspect.
</p>
</div>
</div>
</div>



<div id="outline-container-org83ee3e2" class="outline-2">
<h2 id="2021-02-09-Desktop">Desktop</h2>
<div class="outline-text-2" id="text-2021-02-09-Desktop">
<p>
By which I mean what the X11 (and not wayland) server manages.
</p>

<p>
I'm in the process of migrating from Sawfish to Herbsluftwm.  I've used Sawfish since it was the official Gnome WM back in the 90's (back before Gnome put sugar before protein).  Sawfish is really a terrific stacking/floating WM but I wanted to move to a tiling paradigm.  Sawfish has some rudimentary support for tiling and I initially toyed with adding more but figured I should first try some "real" tiling WMs.  Along came Herbsluftwm which I chose over the others because it had nice graph diagrams right in the man page.  I've since looked at others (awesome, i3, dwm) and they are nice but I got lucky on the first draw and have fallen deeply for it.  So, I bid Sawfish a fond farewell and wish the community all the best (there are tens of us!).
</p>
</div>

<div id="outline-container-org61e6115" class="outline-3">
<h3 id="2021-02-09-Herbsluftwm">Herbsluftwm</h3>
<div class="outline-text-3" id="text-2021-02-09-Herbsluftwm">
<p>
Herbsluftwm [German for autumn wind(ow manager)] is configured by issuing commands from the client application <code>herbstclient</code> (<code>hc</code>).  These commands are typically captured in two files:
</p>

<dl class="org-dl">
<dt><code>autostart</code></dt><dd>main configuration holding keybindings, theme settings and starting any "panels"</dd>
<dt><code>panel.sh</code></dt><dd>a long running process transforming WM events (via <code>hc --idel</code>) and others into input piped to a "bar" program (<code>dzen2</code> is common)</dd>
</dl>

<p>
Both of these are typically found at <code>~/.config/herbstluftwm/</code>.
</p>

<p>
A lot of great shell hackery exists in this space including the default event-driven <code>panel.sh</code> which taught me a thing or three.   But, I wanted to rely on something more "formal" so created <a href="https://brettviren.github.io/herbie">herbie</a>.  It contains Python reimplementations of a lot of Herbsluftwm community shell hackery as well as a few new things.  It's documentation describes how to configure and integrate into <code>autostart</code>.
</p>
</div>
</div>


<div id="outline-container-orgd8a56da" class="outline-3">
<h3 id="orgd8a56da">Rofi</h3>
<div class="outline-text-3" id="text-orgd8a56da">
<p>
My <code>herbie</code> speaks through <code>rofi</code>  in many cases and <code>rofi</code> is used directly for some.
</p>

<ul class="org-ul">
<li><code>rofi-screenshot</code> custom script to take screen shots and optionally upload them to a popular image host with help of <code>maim</code> and <code>rephile</code>.  See <a href="#2021-02-09-Photo-management">Photos</a>.</li>
<li><a href="https://github.com/carnager/rofi-pass"><code>rofi-pass</code></a> for accessing my password store (see <a href="#orge6d2070">Passwords</a>)</li>
</ul>
</div>
</div>

<div id="outline-container-orgaaa5bdc" class="outline-3">
<h3 id="2021-02-09-Sawfish">Sawfish</h3>
<div class="outline-text-3" id="text-2021-02-09-Sawfish">
<p>
The Sawfish X11 window manager was at one time the official WM for
Gnome.  That is the time when I first started using it, moving from
TWM and then FVWM.  I've tried a few since but always come back.
Sawfish is configured and largely written in its own flavor of lisp
(<a href="https://sawfish.fandom.com/wiki/Librep">rep</a>) and so can reasonably be considered the Emacs of window
managers.  For configuration, it does an even better job than Emacs of
providing both a programmable and a GUI configuration method and the
two work largely well together.  Some of the reasons I use Sawfish:
</p>

<ul class="org-ul">
<li>hugely configurable but sane defaults</li>
<li>my fingers have learned the key bindings I chose years (decades!) ago</li>
<li>I bake the configuration into a git repo</li>
<li>I can run an arbitrary program from a command line without opening a terminal</li>
<li>tab-like navigation between virtual desktops</li>
<li>window "filling" which I find a better compromise between stacking and tiling idioms</li>
<li>window dressing with themes and per matched windows (eg, Firefox has no borders)</li>
</ul>
</div>
</div>


<div id="outline-container-org4c2eab7" class="outline-3">
<h3 id="org4c2eab7">Desktop environment</h3>
<div class="outline-text-3" id="text-org4c2eab7">
<p>
I largely have moved away from using a full DE.  I have MATE (Gnome 2) in with Sawfish on some computers but been replacing MATE panel and menus with dzen2 and rofi.
</p>
</div>
</div>
</div>

<div id="outline-container-orga958f6c" class="outline-2">
<h2 id="2021-02-09-Web">Web</h2>
<div class="outline-text-2" id="text-2021-02-09-Web">
</div>


<div id="outline-container-org7a1d490" class="outline-3">
<h3 id="2021-02-09-Firefox">Firefox</h3>
<div class="outline-text-3" id="text-2021-02-09-Firefox">
<p>
Firefox is the least worse web browser despite how Mozilla tries so
hard to kill off its user base.  Not much to say except how I battle
some of its worse behavior:
</p>
</div>

<div id="outline-container-orgfa29ca2" class="outline-4">
<h4 id="orgfa29ca2">Load URL via remote without grabbing attention</h4>
<div class="outline-text-4" id="text-orgfa29ca2">
<p>
Set <code>browser.tabs.loadDivertedInBackground</code> to <code>true</code> in
<code>about:config</code>.  Otherwise sending a URL via remote open will have
Firefox grab focus, possibly switching to it on a different virtual
desktop.  This is super annoying when doing important things like
loading the morning's web comics from <code>liferea</code>.
</p>
</div>
</div>

<div id="outline-container-org1c0b1ab" class="outline-4">
<h4 id="org1c0b1ab">Emacs-like keybindings in firefox</h4>
<div class="outline-text-4" id="text-org1c0b1ab">
<p>
This is one of the most frustrating things and most of the things
found online are wrong.  What to do depends on the desktop environment
<b>and</b> its version <b>and</b> maybe the distribution.
</p>

<p>
Debian <code>buster</code> and MATE 1.20.
</p>

<pre class="example">
gsettings set org.mate.interface gtk-key-theme 'Emacs'
</pre>

<p>
Or, 
</p>


<pre class="example">
~/.config/gtk-3.0/settings.ini:

# Get firefox to use emacs keybindings
[Settings]
gtk-key-theme-name = Emacs
</pre>

<p>
For <a href="https://developer.mozilla.org/en-US/docs/Tools/Settings#Editor_Preferences">editor</a> <code>about:config</code> and
</p>

<div class="org-center">
<p>
devtools.editor.keymap emacs
</p>
</div>
</div>
</div>


<div id="outline-container-org28de096" class="outline-4">
<h4 id="org28de096">Using Emacs to edit text</h4>
<div class="outline-text-4" id="text-org28de096">
<p>
There used to be <a href="../itsalltext/index.html">ItsAllText</a>.  Now there is <a href="https://addons.mozilla.org/en-US/firefox/addon/edit-with-emacs1/">Edit with Emacs</a> and
<a href="https://addons.mozilla.org/en-US/firefox/addon/ghosttext/">GhostText</a>.  The former I could not make work and the latter seems
fine.
</p>

<p>
GhostText needs <code>atomic-chrome</code> to be running on Emacs.  It's
available from the Emacs package sites.  In <a href="#org4bf9b51">Emacs servers</a> I describe
how the Emacs server for atomic-chrome to talk to get started.  The
main Emacs parts in <code>init-atomic-chrome.el</code> are:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #b4fa70;">setq</span> server-name <span style="color: #e9b96e;">"atomic-chrome"</span>)
(<span style="color: #b4fa70;">use-package</span> <span style="color: #e9b2e3;">markdown-mode</span>
  <span style="color: #e090d7;">:ensure</span> t
  <span style="color: #e090d7;">:config</span>
  (<span style="color: #b4fa70;">setq</span> markdown-command <span style="color: #e9b96e;">"/usr/bin/markdown"</span>))
(<span style="color: #b4fa70;">use-package</span> <span style="color: #e9b2e3;">markdown-preview-mode</span>
  <span style="color: #e090d7;">:ensure</span> t)
(<span style="color: #b4fa70;">use-package</span> <span style="color: #e9b2e3;">atomic-chrome</span>
  <span style="color: #e090d7;">:ensure</span> t
  <span style="color: #e090d7;">:config</span>
  (<span style="color: #b4fa70;">setq</span> atomic-chrome-default-major-mode 'markdown-mode)
  (<span style="color: #b4fa70;">setq</span> atomic-chrome-url-major-mode-alist
        '((<span style="color: #e9b96e;">"github\\.com"</span> . gfm-mode)
          (<span style="color: #e9b96e;">"reddit\\.com"</span> . markdown-mode)
          (<span style="color: #e9b96e;">"redmine"</span> . textile-mode)))
  (<span style="color: #b4fa70;">setq</span> atomic-chrome-buffer-open-style 'frame)
)
(atomic-chrome-start-server)
</pre>
</div>

<p>
To use, I click the GhostText icon, sometimes it prompts me for which
text area to edit, then an Emacs frame pops us.  As I type in Emacs
the text entry updates.
</p>
</div>

<div id="outline-container-org66574e4" class="outline-5">
<h5 id="org66574e4"><span class="todo TODO">TODO</span> get nice rendered preview for GitHub and Reddit text entries</h5>
</div>
</div>

<div id="outline-container-orgfdfa56e" class="outline-4">
<h4 id="orgfdfa56e">Bookmark capture</h4>
<div class="outline-text-4" id="text-orgfdfa56e">
<p>
The <code>emacs-capture</code> and Emacs server "capture" is described above.  On the Firefox end I need a bookmarklet:
</p>

<pre class="example">
javascript:location.href='org-protocol://capture://w/'+encodeURIComponent(location.href)+'/'+encodeURIComponent(document.title)+'/'+encodeURIComponent(window.getSelection())
</pre>

<p>
The <code>/w/</code> corresponds to an org capture template
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #b4fa70;">setq</span> org-capture-templates
      (<span style="color: #b4fa70;">quote</span>
       ((<span style="color: #e9b96e;">"w"</span> <span style="color: #e9b96e;">"Web Bookmark"</span> entry
         (file+headline <span style="color: #e9b96e;">"~/org/webcapture.org"</span> <span style="color: #e9b96e;">"Bookmarks"</span>)
         <span style="color: #e9b96e;">"* %a :website:%^G\n:PROPERTIES:\n:CREATED: %U\n:END:\n%i\n %?"</span>
         <span style="color: #e090d7;">:empty-lines</span> 1 <span style="color: #e090d7;">:immediate-finish</span> nil)))
      org-agenda-files (list <span style="color: #e9b96e;">"~/org/webcapture.org"</span>))
</pre>
</div>

<p>
Some frame management is done with:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #b4fa70;">defadvice</span> <span style="color: #fce94f;">org-capture</span>
    (after make-full-window-frame activate)
  <span style="color: #e9b96e;">"Advise capture to be the only window when used as a popup"</span>
 (<span style="color: #b4fa70;">if</span> (equal <span style="color: #e9b96e;">"emacs-capture"</span> (frame-parameter nil 'name))
     (delete-other-windows)))

(<span style="color: #b4fa70;">defadvice</span> <span style="color: #fce94f;">org-capture-finalize</span>
    (after delete-capture-frame activate)
  <span style="color: #e9b96e;">"Advise capture-finalize to close the frame"</span>
  (<span style="color: #b4fa70;">if</span> (equal <span style="color: #e9b96e;">"emacs-capture"</span> (frame-parameter nil 'name))
      (delete-frame)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4855e62" class="outline-4">
<h4 id="org4855e62">Kill Sticky</h4>
<div class="outline-text-4" id="text-org4855e62">
<p>
The web is mostly festering garbage and getting worse over time.  Many web sites, even ones that should know batter (stack overflow) put up so much obscuring crap that it can be hard to see the content.  Enter <b>Kill Sticky</b> (not a Tarantino movie, but better).  It is <a href="https://alisdair.mcdiarmid.org/kill-sticky-headers/">this bookmarklet</a>:
</p>

<pre class="example">
javascript:(function()%7B(function%20()%20%7Bvar%20i%2C%20elements%20%3D%20document.querySelectorAll('body%20*')%3Bfor%20(i%20%3D%200%3B%20i%20%3C%20elements.length%3B%20i%2B%2B)%20%7Bif%20(getComputedStyle(elements%5Bi%5D).position%20%3D%3D%3D%20'fixed')%20%7Belements%5Bi%5D.parentNode.removeChild(elements%5Bi%5D)%3B%7D%7D%7D)()%7D)()
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org68e5278" class="outline-2">
<h2 id="2021-02-09-Source">Source</h2>
<div class="outline-text-2" id="text-2021-02-09-Source">
<p>
See also <a href="#2021-02-09-Configuration">Configuration</a> and individual package sections.  Here I describe ways I install software locally which means outside of Debian's package management.
</p>
</div>

<div id="outline-container-org75b19ee" class="outline-3">
<h3 id="2021-02-09-DIY-opt">DIY opt</h3>
<div class="outline-text-3" id="text-2021-02-09-DIY-opt">
<p>
For some development dependencies, I will build and install using <code>$HOME/opt/&lt;pkg&gt;</code> as the install "prefix".  I try to avoid making these part of day-to-day environment.
</p>
</div>
</div>

<div id="outline-container-org5c9be60" class="outline-3">
<h3 id="2021-02-09-Stow">Stow</h3>
<div class="outline-text-3" id="text-2021-02-09-Stow">
<p>
I used to follow the <a href="#2021-02-09-DIY-opt">DIY opt</a> method to provide software that is built from source until I had a weird time traveling revelation.  I'm essentially the only user on most machines where I need what was in <a href="#2021-02-09-DIY-opt">DIY opt</a> so why not just install to <code>/usr/local</code>.  The one thing that was lacking was pristine uninstallation.  To get that I started using the venerable GNU Stow package.
</p>

<p>
Even though implemented in Perl, GNU Stow works great (joke)!  One-time setup
</p>

<pre class="example">
# mkdir /usr/local/stow
# chgrp staff /usr/local/stow
# chmod g+s /usr/local/stow
# sudo adduser bv staff
</pre>

<p>
I then install from source to a location under the Stow directory with a name based on the package name and version.  Eg
</p>

<pre class="example">
$ ./configure --prefix=/usr/local/stow/rofi-1.6.1/
$ make -j (nproc)
$ make install
</pre>

<p>
Then finish with
</p>

<pre class="example">
# cd /usr/local/stow
# stow rofi-1.6.1
</pre>
</div>
</div>

<div id="outline-container-org1b375dc" class="outline-3">
<h3 id="2021-02-09-CMake">CMake</h3>
<div class="outline-text-3" id="text-2021-02-09-CMake">
<pre class="example">
$ mkdir ~/opt
$ cd pkg
$ mkdir build &amp;&amp; cd build
$ cmake -G Ninja .. -DCMAKE_INSTALL_PREFIX=$HOME/opt/pkg [...]
$ cmake --build . -- -j$(nproc)
$ cmake --build . --target install
</pre>
</div>
</div>

<div id="outline-container-org616e8fb" class="outline-3">
<h3 id="2021-02-09-autoconf">autoconf</h3>
<div class="outline-text-3" id="text-2021-02-09-autoconf">
<pre class="example">
$ mkdir ~/opt
$ cd pkg
$ ./autogen
$ ./configure --prefix=$HOME/opt/pkg
$ make -j$(nproc)
$ make install
</pre>
</div>
</div>


<div id="outline-container-orgbe59eff" class="outline-3">
<h3 id="2021-02-09-Spack">Spack</h3>
<div class="outline-text-3" id="text-2021-02-09-Spack">
</div>
</div>


<div id="outline-container-org7b88cfc" class="outline-3">
<h3 id="2021-02-09-Nix">Nix</h3>
<div class="outline-text-3" id="text-2021-02-09-Nix">
</div>
</div>

<div id="outline-container-orgfc1d652" class="outline-3">
<h3 id="2021-02-09-Python">Python</h3>
<div class="outline-text-3" id="text-2021-02-09-Python">
<p>
When I work on a Python package I use <code>direnv</code> (see also <a href="#2021-02-09-Command-shell">Shells</a>) do:
</p>

<pre class="example">
# apt install direnv
$ cd a-python-package/
$ echo layout python3 &gt; .envrc
$ direnv allow
$ pip install -e .
</pre>

<p>
A lesser way but which does not require <code>direnv</code>
</p>

<pre class="example">
$ python3 -m venv venv
$ source venv/bin/activate
$ pip install -e .
</pre>
</div>
</div>
</div>


<div id="outline-container-org8db4846" class="outline-2">
<h2 id="2021-02-09-Photo-management">Photos</h2>
<div class="outline-text-2" id="text-2021-02-09-Photo-management">
<p>
See also <a href="#2021-02-09-Syncthing">Syncthing</a> for how photos are extracted off my phone.  
</p>
</div>

<div id="outline-container-org93eea7a" class="outline-3">
<h3 id="2021-02-09-Rephile">Rephile</h3>
<div class="outline-text-3" id="text-2021-02-09-Rephile">
<p>
I used to dump photos from scans, cameras or phones into various directories.  This grew organic and I've lost chunks of memories when directories went missing.  So I got "serious" and wrote <a href="https://brettviren.github.io/rephile">rephile</a>.  It still allows a distributed store sprinkled around various directories and it supports <a href="#2021-02-09-Git-annex">git-annex</a> repositories.  It keeps an <code>sqlite</code> database of metadata and has some extras such as uploads to a popular image host.
</p>
</div>
</div>
</div>


<div id="outline-container-org9c7f390" class="outline-2">
<h2 id="2021-02-09-Sync">Sync</h2>
<div class="outline-text-2" id="text-2021-02-09-Sync">
</div>


<div id="outline-container-org0a0e34f" class="outline-3">
<h3 id="2021-02-09-Syncthing">Syncthing</h3>
<div class="outline-text-3" id="text-2021-02-09-Syncthing">
<p>
Syncthing is a jewel of a system.  It's your own personal peer-to-peer (which here means you-to-you or you-to-friends not you-to-anonymous-strangers) file transfer system.  Encryption, distribute hash table, UDP hole punching, simple beautiful web interface, cross platform.  What more can you ask for?
</p>

<p>
I run it on my android phone and all Linux machines, home and at work.
For the phone I sync photos and org files.  For Linux machines various
things but in particular a <code>~/sync/</code> is shared between all and holds
mostly my talks.  My <code>~/org/</code> holds my personal "wiki" where I hold
proto-documents, notes, etc as well as bookmarks grabbed as described
above.
</p>

<p>
One caution: the optional use of relay for data is safe and can be useful to get around tricky routing problems (both ends behind very strict firewalls) but take note that some hosts that provide Syncthing relay are also TOR nodes.  Despite these being wholly separate data streams, some idiot "security" mechanisms will flag your Syncthing as a TOR node because it happens to connect to an Internet host which also happens to provide a TOR service.
</p>
</div>
</div>

<div id="outline-container-orgae6d5fa" class="outline-3">
<h3 id="2021-02-09-Git-annex">Git annex</h3>
<div class="outline-text-3" id="text-2021-02-09-Git-annex">
<p>
tbd. git + big files + sync rules + metadata.  Used for photos and other.  
</p>
</div>
</div>
</div>


<div id="outline-container-orge6d2070" class="outline-2">
<h2 id="orge6d2070">Passwords</h2>
<div class="outline-text-2" id="text-orge6d2070">
</div>
<div id="outline-container-org3434fa7" class="outline-3">
<h3 id="org3434fa7">Pass</h3>
<div class="outline-text-3" id="text-org3434fa7">
<p>
I use <a href="https://git.zx2c4.com/password-store/about/">pass</a>.  I almost never share the same password for different endpoints and almost always use high character random passwords which I never bother to remember.
</p>
</div>
</div>
</div>



<div id="outline-container-org6192cd4" class="outline-2">
<h2 id="2021-02-09-Time">Time</h2>
<div class="outline-text-2" id="text-2021-02-09-Time">
</div>

<div id="outline-container-orgeb7ed2f" class="outline-3">
<h3 id="2021-02-09-arbtt">arbtt</h3>
<div class="outline-text-3" id="text-2021-02-09-arbtt">
<p>
At work we have to "track" our time even though we don't get payed hourly.  It feels to me a very annoying and demeaning thing.  I "protest" by keeping hugely, massively, stupidly pedantic track of my time.  I know, it's nonsensical and weird but it allows me to comply without raising my blood pressure.  Fight idiocy with lunacy, I always say.
</p>

<p>
I do this by running <a href="https://arbtt.nomeata.de/#what">arbtt</a> on my work computers.    It starts with cron
</p>

<pre class="example">
$ crontab -l |grep arbtt
@reboot /home/bv/scripts/start-arbtt-capture
</pre>

<p>
When my employer nags me to enter this very crucial data I run a script
</p>

<pre class="example">
$ time-sheet
...
heather,Sat,2020-05-02,0.87,1.45
heather,Sun,2020-05-03,1.68,1.68
heather,Mon,2020-05-04,2.24,6.77
heather,Tue,2020-05-05,2.80,7.89
heather,Wed,2020-05-06,2.99,5.79
heather,Thu,2020-05-07,8.47,9.47
heather,Fri,2020-05-08,3.49,9.16
heather,Sun,2020-05-10,2.30,3.24
</pre>

<p>
Second to last column shows total hours my session was active, last column is time diff between last action and first in the day (MTW I was on "vacation" so less than nominal eight).  
</p>
</div>
</div>


<div id="outline-container-org2f9f3c6" class="outline-3">
<h3 id="2021-02-09-Meetings">Time zones</h3>
<div class="outline-text-3" id="text-2021-02-09-Meetings">
<p>
I have a <a href="https://superuser.com/a/1397116">hacked scrip</a> to help me with timezones
</p>

<pre class="example">
$ time-to-meet tomorrow
February 10, 2021
Here          08  09  10  11  12  13  14  15  16  17  18  19  20 
UTC           13  14  15  16  17  18  19  20  21  22  23  24  25 (+5)
Los_Angeles   05  06  07  08  09  10  11  12  13  14  15  16  17 (-3)
Chicago       07  08  09  10  11  12  13  14  15  16  17  18  19 (-1)
London        13  14  15  16  17  18  19  20  21  22  23  24  25 (+5)
Zurich        14  15  16  17  18  19  20  21  22  23  24  25  26 (+6)
Japan         22  23  24  25  26  27  28  29  30  31  32  33  34 (+14)
</pre>
</div>
</div>

<div id="outline-container-org5db678c" class="outline-3">
<h3 id="org5db678c">Meetings</h3>
<div class="outline-text-3" id="text-org5db678c">
<p>
Most people around me use "doodle" which is kind of a pain. <a href="https://www.when2meet.com/">when2meet</a> is far superior.
</p>
</div>
</div>
</div>

<div id="outline-container-org7ecaf7d" class="outline-2">
<h2 id="org7ecaf7d">Todo</h2>
<div class="outline-text-2" id="text-org7ecaf7d">
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> factor vcsh repos to move non-secret dotfiles to github and link to them from here</li>
<li class="off"><code>[&#xa0;]</code> section on operating system, Debian GNU/Linux</li>
<li class="off"><code>[&#xa0;]</code> section on ssh (many tips/tricks, jsonnet-based config)</li>
<li class="off"><code>[&#xa0;]</code> section on vpn (nord, linux, phone, router)</li>
<li class="off"><code>[&#xa0;]</code> section on router (tomato firmware)</li>
<li class="off"><code>[&#xa0;]</code> rss</li>
<li class="off"><code>[&#xa0;]</code> videos</li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Brett Viren</p>
<p class="date">Created: 2021-02-09 Tue 13:57</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>

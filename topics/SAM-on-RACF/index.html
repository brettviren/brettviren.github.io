<!DOCTYPE html>
<html lang="en">
  <head>
    
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <title>They Call Me Brett</title>
    
    
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
    
    <link rel="stylesheet" href="/static/font-awesom/css/font-awesome.min.css">
    
    <link rel="stylesheet" href="/static/themes/yeti/css/base.css">
    
    <link rel="stylesheet" href="/static/highlight/styles/default.css">
    
    <link rel="stylesheet" href="/static/octicons/octicons.css">
    
    

    
  </head>
  
  <body>
    

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">

        
        <div class="navbar-header">
          
          
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>

          
          <a class="navbar-brand" href="..">They Call Me Brett</a>
        </div><!-- navbar-header -->

        
        <div class="navbar-collapse collapse">
          
          
          <ul class="nav navbar-nav">
	    
	    
	    
	    <li><a href="topics.html">Articles</a></li>
	    
	    
	    <li><a href="blog.html">Blog</a></li>
	    
	    
	    <li><a href="feed.html">Feeds</a></li>
	    
	    
          </ul>
          
          
          <ul class="nav navbar-nav navbar-right">
	    
            <li >
              <a rel="up" href="..">
                <i class="fa fa-arrow-up"></i> Up
              </a>
            </li>
	    
          </ul>
        </div>

      </div><!-- container -->
    </div><!-- navbar -->

    <div class="container">
      
      <div class="col-md-3">
        <div class="bs-sidebar hidden-print affix well" role="complementary">
          <ul class="nav bs-sidenav">
            <li class="main active"><a href="#">Top</a></li>
	    
<li class="">
  <a href="#sec-1">1. Client Installation.</a><ul class="nav">
<li class="">
  <a href="#sec-1-1">1.1. Eyeball MINOS instructions</a></li>
<li class="">
  <a href="#sec-1-2">1.2. Eyeball FNAL environment</a></li>
<li class="">
  <a href="#sec-1-3">1.3. Eyeballing Redmine</a></li>
<li class="">
  <a href="#sec-1-4">1.4. Package it</a></li></ul></li>
<li class="">
  <a href="#sec-2">2. Playing with samweb</a><ul class="nav">
<li class="">
  <a href="#sec-2-1">2.1. Help and usage</a></li>
<li class="">
  <a href="#sec-2-2">2.2. Definitions</a></li>
<li class="">
  <a href="#sec-2-3">2.3. Projects</a></li>
<li class="">
  <a href="#sec-2-4">2.4. Server info</a><ul class="nav">
<li class="">
  <a href="#sec-2-4-1">2.4.1. Need to figure out authentication.</a></li></ul></li>
<li class="">
  <a href="#sec-2-5">2.5. Admin</a></li>
<li class="">
  <a href="#sec-2-6">2.6. Environment</a></li></ul></li>
<li class="">
  <a href="#sec-3">3. Certificates</a></li>

	  </ul>
	</div>
      </div>
      
      <div class="col-md-9" role="main">

	<h1 class="page-title">
	  
Use of SAM at BNL RACF

	  <small>
</small>
	</h1>
      
	<p/>
	
	

2014-07-05 12:29:18<blockquote>SAM is a file catalog system developed at Fermilab and expected to be used by LBNE.  This topic collects information about its use at BNL's RACF.</blockquote>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Client Installation.</h2>
<div class="outline-text-2" id="text-1">
<p>
Try to install the "<code>samweb</code>" command.
</p>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Eyeball MINOS instructions</h3>
<div class="outline-text-3" id="text-1-1">
<p>
There is no obvious SAM "home page" but <a href="http://www-numi.fnal.gov/sam/">MINOS</a> and <a href="http://www-d0.fnal.gov/computing/sam/">D0</a> come up in Google with some info.  Following <a href="http://www-numi.fnal.gov/sam/get_data.html">Getting Data offsite using SAM</a> from MINOS, download is from:
</p>

<p>
<a href="ftp://ftp.fnal.gov/products/sam_web_services_client/v0_9_2/NULL/">ftp://ftp.fnal.gov/products/sam_web_services_client/v0_9_2/NULL/</a>
</p>

<p>
These files are from 2005&#x2026;..
</p>

<p>
Get the <a href="ftp://ftp.fnal.gov/products/sam_web_services_client/v0_9_2/NULL/sam_web_services_client_v0_9_2_NULL.tar.gz">tarball</a>.  This contains the source (including CVS subdirs and compiled .pyc files) with a <code>bin/</code> and <code>lib/</code> areas holding links into <code>src/</code>.  It spews all its files to the current working directory.  It has some <code>sam_setup.*</code> scripts which interact with UPS.
</p>

<p>
There is nothing called "samweb" in this distribution&#x2026;.
</p>

<p>
Google ="samweb" site:fnal.gov= brings up lots of mention in presentations but no useful resources.
</p>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Eyeball FNAL environment</h3>
<div class="outline-text-3" id="text-1-2">
<pre class="example">
local&gt; ssh bv@lbnegpvm01.fnal.gov
fnal&gt; source /nusoft/app/externals/setup
fnal&gt; ups list -aK+ | grep sam
"sam_web_client" "v1_2" "NULL" "" "" 
"sam_web_client" "v1_3" "NULL" "" "current" 
ERROR: No instance matches were made between the 
version file (/nusoft/app/externals/cppunit/v1_12_1.version) and the 
table file (cppunit.table) for flavor (Linux64bit+2.6-2.5) and qualifiers (gcc45)
ERROR: Possible UPS database (/nusoft/app/externals) corruption in product 'cppunit'.
ERROR: No instance matches were made between the 
version file (/nusoft/app/externals/postgresql/v9_1_3.version) and the 
table file (postgresql.table) for flavor (Linux64bit+2.6-2.5) and qualifiers (gcc46)
ERROR: Possible UPS database (/nusoft/app/externals) corruption in product 'postgresql'.
</pre>

<p>
Presumably those ERRORs mean UPS is working extra hard to make my life more complicated than it needs to be.
</p>

<p>
Anyways,
</p>

<pre class="example">
fnal&gt; setup sam_web_client
fnal&gt; echo $PYTHONPATH
/nusoft/app/externals/sam_web_client/v1_3/NULL/python
fnal&gt; ls /nusoft/app/externals/sam_web_client/v1_3/NULL/python
samweb_client  samweb_cli.py  samweb_cli.pyc  simplejson_209
fnal&gt; ls /nusoft/app/externals/sam_web_client/v1_3/NULL/bin
samweb
</pre>

<p>
Attempt to reproduce Robert Illingworth's example which is:
</p>

<pre class="example">
$ samweb -e lbne get-file-access-url --schema=root 35T_singleparticle_pizero_30_0.root
root://fndca1.fnal.gov:1094/pnfs/fnal.gov/usr/lbne/mc/lbne/simulated/001/35T_singleparticle_pizero_30_0.root
</pre>

<p>
Now my turn:
</p>

<pre class="example">
samweb -e lbne get-file-access-url --schema=root 35T_singleparticle_pizero_30_0.root
Unknown command get-file-access-url
usage: samweb [base options] &lt;command&gt; [command options] ...
</pre>

<p>
We are not off to a good start here, folks.
</p>

<p>
Eyeballing some NoVA SAM tutorial presentation (why tf is there no established web info on all this???) and reading through their layers of setup scripts I see that they use:
</p>

<pre class="example">
$ setup sam_web_client v1_5 -z /grid/fermiapp/products/common/db
</pre>

<p>
That UPS area has <code>sam_web_client</code> up to version 1.7.  This UPS area has an installation pattern I've not seen before.  The actual installed files are in "<code>../prd/</code>".
</p>

<p>
That 1.5 version also doesn't do it for me.  This does:
</p>

<pre class="example">
fnal&gt; unsetup sam_web_client
fnal&gt; setup sam_web_client v1_7 -z /grid/fermiapp/products/common/db
fnal&gt; samweb -e lbne get-file-access-url --schema=root 35T_singleparticle_pizero_30_0.root
root://fndca1.fnal.gov:1094/pnfs/fnal.gov/usr/lbne/mc/lbne/simulated/001/35T_singleparticle_pizero_30_0.root
</pre>

<p>
What a mess.
</p>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Eyeballing Redmine</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Oh, look, SAM has a <a href="https://cdcvs.fnal.gov/redmine/projects/sam-main">huge presence in FNAL Redmine</a>.  I wonder why Google fails to find this.  I suspect <code>robots.txt</code> is shunning the crawlers. 
</p>

<p>
Okay, reboot this.
</p>

<pre class="example">
$ git clone http://cdcvs.fnal.gov/projects/sam-web-client
$ ls -l sam-web-client/
total 24
drwxr-xr-x 2 bvlbne lbne 4096 Jul  1 10:14 bin
-rw-r--r-- 1 bvlbne lbne  628 Jul  1 10:14 Makefile
drwxr-xr-x 4 bvlbne lbne 4096 Jul  1 10:14 python
-rwxr-xr-x 1 bvlbne lbne  357 Jul  1 10:14 release.sh
drwxr-xr-x 2 bvlbne lbne 4096 Jul  1 10:14 test
drwxr-xr-x 2 bvlbne lbne 4096 Jul  1 10:14 ups
$ ls -l sam-web-client/python/
total 48
drwxr-xr-x 2 bvlbne lbne  4096 Jul  1 10:14 samweb_client
-rw-r--r-- 1 bvlbne lbne 39091 Jul  1 10:14 samweb_cli.py
drwxr-xr-x 2 bvlbne lbne  4096 Jul  1 10:14 simplejson_209
$ ls -l sam-web-client/bin/
total 4
-rwxr-xr-x 1 bvlbne lbne 324 Jul  1 10:14 samweb
</pre>

<p>
And:
</p>

<pre class="example">
./sam-web-client/bin/samweb -e lbne get-file-access-url --schema=root 35T_singleparticle_pizero_30_0.root
root://fndca1.fnal.gov:1094/pnfs/fnal.gov/usr/lbne/mc/lbne/simulated/001/35T_singleparticle_pizero_30_0.root
</pre>


<p>
Okay, this is much more reasonable!
</p>
</div>
</div>

<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> Package it</h3>
<div class="outline-text-3" id="text-1-4">
<p>
It sure would be nice if this was a Python package.
</p>

<pre class="example">
from distutils.core import setup
setup(name = 'sam-web-client',
      version = '1.7',
      description = 'Python client and command line interface to SAM Web',
      author = 'SAM Team',
      author_email = 'sam-users@listserv.fnal.gov',
      url = 'https://cdcvs.fnal.gov/redmine/projects/sam-web-client',
      package_dir = {'':'python'},
      py_modules = ['samweb_cli'],
      packages = ['samweb_client', 'simplejson_209'],
      scripts = ['bin/samweb'],
      )
</pre>

<pre class="example">
$ python setup.py sdist
$ ls -l dist/sam-web-client-1.7.tar.gz 
-rw-r--r-- 1 bvlbne lbne 40359 Jul  1 10:42 dist/sam-web-client-1.7.tar.gz
$ virtualenv ~/venv/sam
$ python setup.py install
$ source ~/venv/sam/bin/activate
$ samweb -e lbne get-file-access-url --schema=root 35T_singleparticle_pizero_30_0.root
root://fndca1.fnal.gov:1094/pnfs/fnal.gov/usr/lbne/mc/lbne/simulated/001/35T_singleparticle_pizero_30_0.root
</pre>

<p>
Now we are cooking!
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Playing with samweb</h2>
<div class="outline-text-2" id="text-2">
<p>
What kind of trouble can I get into now?
</p>
</div>

<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> Help and usage</h3>
<div class="outline-text-3" id="text-2-1">
<pre class="example">
$ samweb -h
[ usage ]
$ samweb
[... list of commands ...]
</pre>

<p>
Metadata:
</p>

<pre class="example">
$ samweb -e lbne get-metadata 35T_singleparticle_pizero_30_0.root
            File Name: 35T_singleparticle_pizero_30_0.root
              File Id: 4837
            File Type: mc
          File Format: root
            File Size: 142974667
                  Crc: 2012523085 (adler 32 crc type)
       Content Status: good
                Group: lbne
            Data Tier: simulated
          Application: art lar s2013.04.21
          Event Count: 100
          First Event: 1
           Last Event: 100
           Start Time: 2013-04-24T10:15:10
             End Time: 2013-04-24T10:15:10
lbne_MC.detector_type: 35t
         lbne_MC.name: 35T_singleparticle_pizero_30
                 Runs: 1 (physics)
</pre>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Definitions</h3>
<div class="outline-text-3" id="text-2-2">
<pre class="example">
$ samweb -e lbne list-definitions
diesburg-test-project-01
diesburg-test-project-02
genieCRY_20130423_anuflux_nuebarflux_nuebar_g280_Ar40
genieCRY_20130423_anuflux_nueflux_nue_g280_Ar40
genieCRY_20130423_anuflux_numubarflux_nuebar_g280_Ar40
genieCRY_20130423_anuflux_numubarflux_numubar_g280_Ar40
mwm_test_1
qtest1
singleparticle-test

$ samweb -e lbne list-definition-files singleparticle-test
35T_singleparticle_piplus_01.root
35T_singleparticle_proton_01.root
</pre>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> Projects</h3>
<div class="outline-text-3" id="text-2-3">
<pre class="example">
$ samweb -e lbne list-projects
...
diesburg_singleparticle-test_20140109152050
...

$ samweb -e lbne find-project diesburg_singleparticle-test_20140109152050
http://samweb.fnal.gov:8480/sam/lbne/api/projects/lbne/diesburg_singleparticle-test_20140109152050

$ wget http://samweb.fnal.gov:8480/sam/lbne/api/projects/lbne/diesburg_singleparticle-test_20140109152050
--2014-07-01 11:16:35--  http://samweb.fnal.gov:8480/sam/lbne/api/projects/lbne/diesburg_singleparticle-test_20140109152050
Connecting to 192.168.1.130:3128... connected.
Proxy request sent, awaiting response... 404 Not Found
2014-07-01 11:16:35 ERROR 404: Not Found.
</pre>
</div>
</div>

<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> Server info</h3>
<div class="outline-text-3" id="text-2-4">
<pre class="example">
$ samweb -e lbne server-info
SAMWeb API for lbne
Server version: 1.7.6
Cherrypy version: 3.2.4
HTTP User-Agent: SAMWebClient/unknown (samweb) python/2.6.6
User information:
  Untrusted identity: bvlbne@lbne0001.rcf.bnl.gov
  Unauthenticated
</pre>
</div>

<div id="outline-container-sec-2-4-1" class="outline-4">
<h4 id="sec-2-4-1"><span class="section-number-4">2.4.1</span> <span class="todo TODO">TODO</span> Need to figure out authentication.</h4>
</div>
</div>

<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5"><span class="section-number-3">2.5</span> Admin</h3>
<div class="outline-text-3" id="text-2-5">
<pre class="example">
$ samweb -e lbne list-applications
art	lar	dev2013.07.19
demo	demo	demo
art	lar	s2013.04.21
demo	demo	1
art	lar	s2013.10.21
test	test	1

$ samweb -e lbne list-data-disks
lbnedata:/lbne/data

$ samweb -e lbne list-parameters
lbne_MC.overlay (string)
lbne_MC.geometry_version (string)
lbne_MC.miscellaneous (string)
lbne_MC.mass_hierarchy (string)
lbne_MC.neutrino_flavors (string)
lbne_MC.detector_type (string)
lbne_MC.name (string)
lbne_MC.trigger-list-version (string)
lbne_MC.oscillationP (string)
lbne_MC.generators (string)
lbne_MC.beam_flux_ID (true_int)
lbne_MC.beam_energy (true_float)

$  samweb -e lbne list-users
...
bv
...
</pre>

<p>
Hey, that's me!
</p>

<pre class="example">
$ samweb -e lbne list-values --help-categories
Available database categories:

data_tiers
    Data tier of a file (raw, simulated, reconstructed, etc)
run_types
    Type of a run
groups
    Work groups
data_streams
    Data stream names
file_formats
    Format of the file
file_types
    Type (ie general purpose) of a file

$ samweb -e lbne list-values data_tiers
simulated
raw
hit-reconstructed
full-reconstructed
generated

$ samweb -e lbne list-values run_types
cosmic
test
calibration
physics
special

$ samweb -e lbne list-values groups
lbne

$ samweb -e lbne list-values data_streams

$ samweb -e lbne list-values file_formats
unknown
root
tar
text

$ samweb -e lbne list-values file_types
mc
test-data
unknown
fastmc
physics-data
calib-data
</pre>

<p>
Grand.
</p>
</div>
</div>


<div id="outline-container-sec-2-6" class="outline-3">
<h3 id="sec-2-6"><span class="section-number-3">2.6</span> Environment</h3>
<div class="outline-text-3" id="text-2-6">
<p>
I see <a href="https://cdcvs.fnal.gov/redmine/projects/sam-web/wiki/Using-samweb">here</a> that one can set <code>SAM_EXPERIMENT=lbne</code> to avoid "<code>-e lbne</code>" option each time.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Certificates</h2>
<div class="outline-text-2" id="text-3">
<p>
While not strictly related to SAM, to use SAM to actually access files one needs a certificate registered into the LBNE VO.  Once this is done one may do:
</p>

<pre class="example">
$ source /afs/usatlas.bnl.gov/osg/client/@sys/current/setup.sh
$ voms-proxy-init -voms lbne
</pre>

<p>
Note, we piggy back on ATLAS for setting up Grid stuff.  
</p>

<p>
If you see:
</p>

<pre class="example">
$ voms-proxy-init -voms lbne
Enter GRID pass phrase:
Your identity: /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Brett Viren 2598
Creating temporary proxy ................................................... Done
Contacting  voms.fnal.gov:15029 [/DC=org/DC=doegrids/OU=Services/CN=http/voms.fnal.gov] "lbne" Failed

Error: lbne: User unknown to this VO.

None of the contacted servers for lbne were capable
of returning a valid AC for the user.
</pre>

<p>
It means you need to <a href="https://voms.fnal.gov:8443/voms/lbne/register">register your cert with LBNE VO</a>.
</p>

<p>
If you see:
</p>

<pre class="example">
voms-proxy-init -voms lbne
Enter GRID pass phrase:
Your identity: /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Brett Viren 2598
Creating temporary proxy .......................................................................................... Done
Contacting  voms.fnal.gov:15029 [/DC=org/DC=doegrids/OU=Services/CN=http/voms.fnal.gov] "lbne" Done
Creating proxy ........................... Done

Your proxy is valid until Wed Jul  2 00:57:54 2014
Error: verify failed.
Cannot verify AC signature!
</pre>

<p>
It means&#x2026;
</p>
</div>
</div>



      <p/>
      </div><!-- main -->
      
      
    </div><!-- content container -->
    


    

    <footer class="col-md-12">
      
<hr/>
<a href="index.org">Org (index.org)</a><br>
<a href="index.pdf">PDF (index.pdf)</a><br>
<p>
  Created: 2014-07-05 12:29:18<br>
  Revised: 2014-07-05 12:29:18<br>

    </footer>

    
    
    
    <script src="/static/jquery-1.12.0.min.js"></script>
    
    <script src="/static/bootstrap/js/bootstrap.min.js"></script>
    
    <script src="/static/highlight/highlight.pack.js"></script>
    
    <script src="/static/joy.js"></script>
    
    
    
    
    
    
     
  </body>

</html>
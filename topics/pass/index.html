<!DOCTYPE html>
<html lang="en">
  <head>
    
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <title>They Call Me Brett</title>
    
    
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
    
    <link rel="stylesheet" href="/static/font-awesom/css/font-awesome.min.css">
    
    <link rel="stylesheet" href="/static/themes/yeti/css/base.css">
    
    <link rel="stylesheet" href="/static/highlight/styles/default.css">
    
    <link rel="stylesheet" href="/static/octicons/octicons.css">
    
    

    
  </head>
  
  <body>
    

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">

        
        <div class="navbar-header">
          
          
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>

          
          <a class="navbar-brand" href="..">They Call Me Brett</a>
        </div><!-- navbar-header -->

        
        <div class="navbar-collapse collapse">
          
          
          <ul class="nav navbar-nav">
	    
	    
	    
	    <li><a href="topics.html">Articles</a></li>
	    
	    
	    <li><a href="blog.html">Blog</a></li>
	    
	    
	    <li><a href="feed.html">Feeds</a></li>
	    
	    
          </ul>
          
          
          <ul class="nav navbar-nav navbar-right">
	    
            <li >
              <a rel="up" href="..">
                <i class="fa fa-arrow-up"></i> Up
              </a>
            </li>
	    
          </ul>
        </div>

      </div><!-- container -->
    </div><!-- navbar -->

    <div class="container">
      
      <div class="col-md-3">
        <div class="bs-sidebar hidden-print affix well" role="complementary">
          <ul class="nav bs-sidenav">
            <li class="main active"><a href="#">Top</a></li>
	    
<li class="">
  <a href="#sec-1">1. Getting started</a><ul class="nav">
<li class="">
  <a href="#sec-1-1">1.1. Installation</a></li>
<li class="">
  <a href="#sec-1-2">1.2. Initialization</a></li></ul></li>
<li class="">
  <a href="#sec-2">2. Import</a><ul class="nav">
<li class="">
  <a href="#sec-2-1">2.1. KeePassX</a></li>
<li class="">
  <a href="#sec-2-2">2.2. LastPass</a></li></ul></li>
<li class="">
  <a href="#sec-3">3. Integration</a><ul class="nav">
<li class="">
  <a href="#sec-3-1">3.1. Bash</a></li>
<li class="">
  <a href="#sec-3-2">3.2. Emacs</a></li>
<li class="">
  <a href="#sec-3-3">3.3. X11</a><ul class="nav">
<li class="">
  <a href="#sec-3-3-1">3.3.1. Selection</a></li>
<li class="">
  <a href="#sec-3-3-2">3.3.2. dmenu</a></li>
<li class="">
  <a href="#sec-3-3-3">3.3.3. Sawfish</a></li></ul></li></ul></li>
<li class="">
  <a href="#sec-4">4. Git tricks</a><ul class="nav">
<li class="">
  <a href="#sec-4-1">4.1. Sync to remote</a></li>
<li class="">
  <a href="#sec-4-2">4.2. Second local</a></li></ul></li>
<li class="">
  <a href="#sec-5">5. Usage</a><ul class="nav">
<li class="">
  <a href="#sec-5-1">5.1. Organization</a></li>
<li class="">
  <a href="#sec-5-2">5.2. Conflict with Gnome Keyring Manager</a></li></ul></li>
<li class="">
  <a href="#sec-6">6. Links</a></li>
<li class="">
  <a href="#sec-7">7. Ideas</a><ul class="nav">
<li class="">
  <a href="#sec-7-1">7.1. Hashed key index</a></li>
<li class="">
  <a href="#sec-7-2">7.2. Template-based Filters</a></li></ul></li>

	  </ul>
	</div>
      </div>
      
      <div class="col-md-9" role="main">

	<h1 class="page-title">
	  
The zx2c4 =pass= password manager

	  <small>
</small>
	</h1>
      
	<p/>
	
	

2015-08-15 17:46:35(revised 2015-12-30 01:09:04 )<blockquote>Notes on using the =pass= command line password manager.</blockquote>
<p>
I'm moving from KeePassX and LastPass to zx2c4 <code>pass</code> command line password manager.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Getting started</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Installation</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Pass is available as a Debian/Ubuntu package or easy to install from source.
</p>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Initialization</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Initialize the store using an encryption subkey created just for this purpose.
</p>

<pre class="example">
$ pass init '0x4B774E09F6E1EDE9'
mkdir: created directory '/home/bv/.password-store/'
Password store initialized for 0x4B774E09F6E1EDE9
$ pass git init
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Import</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> KeePassX</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Use the KeePassX GUI to export to XML.
</p>

<pre class="example">
$ git clone http://git.zx2c4.com/password-store
$ cd password-store/contrib/importers
$ python keepassx2pass.py ~/keepassx.xml
Importing ....
$ rm ~/keepassx.xml
</pre>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> LastPass</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Use LastPass web UI to download CSV.
</p>

<pre class="example">
$ ruby lastpass2pass.rb ~/lastpass.csv
$ rm ~/lastpass.csv
... 
46 records successfully imported!
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Integration</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Bash</h3>
<div class="outline-text-3" id="text-3-1">
<p>
The main integration with the command line is through completion.
When installed as a system package doing the usual:
</p>

<pre class="example">
source /etc/bash_completion
</pre>

<p>
should be what is needed.  If <code>pass</code> is installed from source it may
be required to copy the <code>pass.bash-completion</code> script somewhere and
source it explicitly.
</p>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Emacs</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Install <code>password-store</code> from <code>package-list-packages</code> then use <code>password-store-*</code> functions.
</p>
</div>
</div>


<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> X11</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Pass is command-line oriented but can be easily and well integrated into X11 desktop environments.
</p>
</div>

<div id="outline-container-sec-3-3-1" class="outline-4">
<h4 id="sec-3-3-1"><span class="section-number-4">3.3.1</span> Selection</h4>
<div class="outline-text-4" id="text-3-3-1">
<p>
By default <code>pass</code> uses <code>xclip</code> to send the password to the X11
"clipboard".  This is not the selection buffer which gets pasted with
Mouse-Button-3.  To fix:
</p>

<pre class="example">
$ export PASSWORD_STORE_X_SELECTION=primary
</pre>
</div>
</div>

<div id="outline-container-sec-3-3-2" class="outline-4">
<h4 id="sec-3-3-2"><span class="section-number-4">3.3.2</span> dmenu</h4>
<div class="outline-text-4" id="text-3-3-2">
<p>
Dmenu is a lightweight mechanism to display a bar across the top/bottom of your X11 screen in order to make a selection.  Zenity could also be used but dmenu is fast, noninstrusive and requires no mousing.  Pass comes with passmenu to integrate pass with dmenu.  I've hacked my copy to:
</p>

<ul class="org-ul">
<li>set the store selection to <code>primary</code> (if used)
</li>
<li>make sure my copy of <code>pass</code> is in the <code>PATH</code>
</li>
<li>set the font to use for <code>dmenu</code> 
</li>
</ul>

<p>
Test with
</p>
<pre class="example">
$ passmenu --type
</pre>
</div>
</div>

<div id="outline-container-sec-3-3-3" class="outline-4">
<h4 id="sec-3-3-3"><span class="section-number-4">3.3.3</span> Sawfish</h4>
<div class="outline-text-4" id="text-3-3-3">
<p>
My X11 sessions are based on the <a href="http://sawfish.wikia.com/">Sawfish WM</a> + <a href="http://mate-desktop.org/">MATE DE</a>.  To integrate Pass I bind the above command to the <code>Super-s</code> key.  I also make a little <code>runmenu</code> script which essentially just calls <code>dmenu_run</code> and bind that to the <code>Super-r</code> key. 
</p>

<p>
To use a password in this environment, I put focus to the targeted password field, type <code>Super-s</code>, select the password key using <code>dmenu</code> functionality, hit <code>ENTER</code> and provide my GPG passphrase if needed.  The password is then auto-typed.
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Git tricks</h2>
<div class="outline-text-2" id="text-4">
<p>
Pass can use <code>git</code> to manage the <code>~/.password-store</code>.  Here are some tips/tricks.
</p>
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> Sync to remote</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Following <a href="http://lists.zx2c4.com/pipermail/password-store/2015-January/001331.html">this mailing list post</a> set up for syncing to a remote git repository.  The <code>local</code> machine is where the initial Pass password store exists.
</p>

<pre class="example">
remote$ git init --bare ~/git/password-store

local$ pass git remote add origin ssh://USE@REMOTE:/home/USER/git/password-store
local$ cd ~/.password-store
local$ git push --set-upstream origin master
local$ cat &lt;&lt;EOF &gt; .git/hooks/post-commit
git pull --rebase
git push
EOF
local$ chmod +x .git/hooks/post-commit
</pre>

<p>
Test with:
</p>

<pre class="example">
local$ git generate foo 20
[logging from git showing a pull/push]
</pre>

<p>
Note, only do this on password stores where generating the ssh/git traffic on each change to the store is acceptable.
</p>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> Second local</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Other local password stores using the remote are set up similarly.
</p>

<pre class="example">
$ pass init '0x4B774E09F6E1EDE9'
$ pass git init
$ pass git remote add origin ssh://bv@haiku:/home/bv/git/password-store
$ pass git branch --set-upstream-to=origin/master master
$ pass git pull --rebase
$ pass show foo
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Usage</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Organization</h3>
<div class="outline-text-3" id="text-5-1">
<p>
After importing from KeePassX and LastPass I had a hodge-podge of directories and files.  With KeePassX I had folder organization that roughly followed a domain- or task-based hierarchy.  LastPass tends to impose its own organization.  KeePassX helps to enforce some organization by encouraging making new entries in the context of old ones while LastPass follows more a capture-and-store approach and leaves any context forming as a follow-on activity (which I never did).  Finally, the conversion process uses name or title of the entry with some character munging to make it file-system-friendly.  To make matters worse, both my KeePassX and LastPass stores have a lot of overlap (and yet worse, one whole folder came from a previous use of Revelation).  All in all, it's a mess and the only solution is develop some sorter or just deal with things manually.
</p>

<p>
The organization I chose is a reverse domain name hierarchy + group/application + user but flattened.  For example, the password for a my account in the <a href="http://www.phy.bnl.gov/edg/w/">EDG wiki</a> goes at:
</p>

<pre class="example">
gov/bnl/phy/www/edg/wiki/bv
</pre>

<p>
Some things like SSH key passphrases or domain passwords transcend some levels of the hierarchy so I have:  
</p>

<pre class="example">
ssh/&lt;some-name&gt;
gov/bnl/domain/bviren
gov/bnl/phy/domain/admin
</pre>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> Conflict with Gnome Keyring Manager</h3>
<div class="outline-text-3" id="text-5-2">
<pre class="example">
$ pass show dir/name
gpg: WARNING: The GNOME keyring manager hijacked the GnuPG agent.
gpg: WARNING: GnuPG will not work properly - please configure that tool to not interfere with the GnuPG system!
...
</pre>

<p>
<a href="https://gebner.org/how-to-get-rid-of-the-the-gnome-keyring-manager-hijacked-the-gnupg-agent-warning.html">Oh my</a>.  Oh, hell, why not.
</p>

<pre class="example">
$ sudo sed -i s/AGENT_ID/AGENX_ID/ `which gpg2`
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Links</h2>
<div class="outline-text-2" id="text-6">
<ul class="org-ul">
<li><a href="https://news.ycombinator.com/item?id=7495337">Hacker News entry on Pass</a> with some good ideas
</li>
</ul>
</div>
</div>


<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Ideas</h2>
<div class="outline-text-2" id="text-7">
<p>
One thing that makes <code>pass</code> great is that it's simple and open to interpretation. Here are some ideas for further development.
</p>
</div>

<div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> Hashed key index</h3>
<div class="outline-text-3" id="text-7-1">
<p>
By default, <code>pass</code> shows the key by which a password is looked up in plain text as the directory/file name.  It is typical to usage domain of the password into this key which means anyone able to see the password store can know what domains one accesses.  A common method suggested to combat this is simply making the password store reside in an ENCFS or other type of encrypted container.
</p>

<p>
Another option is to use a (SHA1) hash for the file name and maintain an encrypted index file that associates a human-readable key with that hash.  This key can then be any sort of meta data.
</p>

<pre class="example">
# ~/.password-store/.pass-index
da39a3ee5e6b4b0d3255bfef95601890afd80709 file://some/entry/filename 
da39a3ee5e6b4b0d3255bfef95601890afd80709 file://someother/entry/filename 
da39a3ee5e6b4b0d3255bfef95601890afd80709 mailto:user@example.com
da39a3ee5e6b4b0d3255bfef95601890afd80709 http://example.com/app
</pre>

<p>
The example shows using URL schema to name the key (with <code>file://</code> being left implicit)
</p>

<p>
For this to be useful, <code>pass</code>'s completion functions would need support added.  To help write them more succinctly and consistently between shells, the <code>pass</code> command itself should provide some abstraction:
</p>

<pre class="example">
$ pass complete --scheme file some
some/entry/filename 
someother/entry/filename 
$ pass complete --scheme mail example
user@example.com
</pre>

<p>
Some problems with this idea mostly have to do with complexity and incompatibility.
</p>

<p>
There is a slippery slope with this index as it's not much more of a leap to specify using a "proper", single-file database.  But, this one step still preserves the one-password-per-file structure which makes things amenable to using git.
</p>

<p>
Some conversion process is needed that will take a nominal password store and make the index, renaming/moving/removing the plain-named entries.
</p>

<p>
If the hash is based on the content of the entry, then any edits needs to rewrite the hash for the filename as well as the index.  Git is already doing this so maybe it's better implemented on top of a bare git repository (but see the slippery slope above).  
</p>

<p>
Maybe a better, simpler, approach is to merely augment the <code>pass</code> status quo and use a file naming scheme that merely obfuscates the entry's domain.  Then, the index can become a simple key-filename lookup to allow for more memorable keys.  
</p>

<pre class="example">
# ~/.password-store/.pass-index
some/entry/filename.gpg alias: an-alias
some/entry/filename.gpg alias: an alias with spaces
some/entry/filename.gpg email: user@example.com
some/entry/filename.gpg url: http://example.com/app
</pre>

<p>
This index can processed regenerated periodically to remove files that no longer exist, warn about unindexed files.  It could also be fully generated based on interpreting the entries.  
</p>
</div>
</div>

<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2"><span class="section-number-3">7.2</span> Template-based Filters</h3>
<div class="outline-text-3" id="text-7-2">
<p>
At its core, the only semantic interpretation <code>pass</code> makes on an entry is that the first line is the password.  A common extension, and one that is supported by at least the two converters I applied, is that subsequent lines contain named fields and/or free-form text.
</p>

<p>
The LastPass converter produces entries like:
</p>
<pre class="example">
&lt;password&gt;
---
&lt;category&gt; / &lt;site&gt; / &lt;hierarchy&gt;
username: &lt;username&gt;
password: &lt;password&gt;
url: &lt;url&gt;
....
</pre>

<p>
The KeePassX produces:
</p>
<pre class="example">
&lt;password&gt;
username: &lt;username&gt;
url: &lt;url&gt;
comment: &lt;free-form, multi-line text&gt;
</pre>

<p>
The idea with template-based filters is to develop a parser of the commonly created entries, make the fields available to a template system to produce new output forms.  For example, 
</p>

<pre class="example">
$ pass show &lt;name&gt; | pass-filter auto-type-user-pass.j2
</pre>

<p>
This might be then used to provide login auto typing like:
</p>

<pre class="example">
xdotool - &lt;&lt;&lt;"type --clearmodifiers -- $(pass show &lt;name&gt; | pass-filter auto-type-user-pass.j2)"
</pre>

<p>
Where the (Jinja2) template file might look like:
</p>

<div class="org-src-container">

<pre class="src src-jinja2">{{ username }}\t{{ password }}\n
</pre>
</div>

<p>
The <code>pass-filter</code> command would be responsible for trying to guess the entry format or be told it explicitly
</p>

<pre class="example">
$ pass show from-keepassx/entry | pass-filter
$ pass show from-lastpass/entry | pass-filter --lastpass
$ pass show json/entry_in_json | pass-filter --json
$ pass show yaml/entry_in_yaml | pass-filter --json
</pre>
</div>
</div>
</div>



      <p/>
      </div><!-- main -->
      
      
    </div><!-- content container -->
    


    

    <footer class="col-md-12">
      
<hr/>
<a href="index.org">Org (index.org)</a><br>
<a href="index.pdf">PDF (index.pdf)</a><br>
<p>
  Created: 2015-08-15 17:46:35<br>
  Revised: 2015-12-30 01:09:04<br>

    </footer>

    
    
    
    <script src="/static/jquery-1.12.0.min.js"></script>
    
    <script src="/static/bootstrap/js/bootstrap.min.js"></script>
    
    <script src="/static/highlight/highlight.pack.js"></script>
    
    <script src="/static/joy.js"></script>
    
    
    
    
    
    
     
  </body>

</html>